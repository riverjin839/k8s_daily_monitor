# ============================================
# K8s Daily Monitor - Helm Values
# ============================================

# -- 글로벌 설정
global:
  # -- 컨테이너 이미지 레지스트리
  imageRegistry: ""
  # -- 이미지 Pull Secret (private registry용)
  imagePullSecrets: []

# -- 앱 설정
config:
  appName: "K8s Daily Monitor"
  debug: "false"
  checkIntervalMinutes: "5"
  checkTimeoutSeconds: "30"
  ansiblePlaybookDir: "/app/ansible/playbooks"
  ansibleInventoryDir: "/app/ansible/inventory"

# -- Secret 설정
secrets:
  databaseUser: "postgres"
  databasePassword: "changeme-in-production"
  secretKey: "your-super-secret-key-change-this-in-production"

# ============================================
# Backend (FastAPI)
# ============================================
backend:
  replicaCount: 2
  image:
    repository: k8s-daily-monitor/backend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  livenessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 30
    periodSeconds: 10
  readinessProbe:
    httpGet:
      path: /health
      port: 8000
    initialDelaySeconds: 10
    periodSeconds: 5

# ============================================
# Frontend (Nginx + React)
# ============================================
frontend:
  replicaCount: 2
  image:
    repository: k8s-daily-monitor/frontend
    tag: latest
    pullPolicy: Always
  service:
    type: ClusterIP
    port: 80
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# ============================================
# PostgreSQL
# ============================================
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"
  storage:
    size: 10Gi
    storageClassName: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# ============================================
# Redis
# ============================================
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
  maxmemory: "256mb"
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# ============================================
# Celery
# ============================================
celery:
  worker:
    replicaCount: 2
    concurrency: 2
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "512Mi"
        cpu: "500m"
  beat:
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "200m"

# ============================================
# Ingress
# ============================================
ingress:
  enabled: true
  className: nginx
  host: k8s-monitor.local
  annotations: {}

# ============================================
# HPA (Horizontal Pod Autoscaler)
# ============================================
hpa:
  enabled: true
  backend:
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilization: 70
  celeryWorker:
    minReplicas: 2
    maxReplicas: 8
    targetCPUUtilization: 70
  frontend:
    minReplicas: 2
    maxReplicas: 6
    targetCPUUtilization: 70

# ============================================
# RBAC
# ============================================
serviceAccount:
  create: true
  name: k8s-monitor-sa

# ============================================
# Monitoring Stack (Prometheus + Grafana)
# ============================================
monitoring:
  enabled: true
  prometheus:
    image:
      repository: prom/prometheus
      tag: "v2.51.0"
    retention: "15d"
    resources:
      requests:
        memory: "256Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "500m"
  grafana:
    image:
      repository: grafana/grafana
      tag: "10.4.0"
    adminUser: "admin"
    adminPassword: "admin"
    anonymousAccess: true
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "300m"
  kubeStateMetrics:
    image:
      repository: registry.k8s.io/kube-state-metrics/kube-state-metrics
      tag: "v2.12.0"
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"
  nodeExporter:
    image:
      repository: prom/node-exporter
      tag: "v1.7.0"
    resources:
      requests:
        memory: "32Mi"
        cpu: "25m"
      limits:
        memory: "64Mi"
        cpu: "100m"

# ============================================
# OpenClaw AI Alert Agent (Optional)
# ============================================
openclaw:
  enabled: false
  image:
    repository: openclaw/openclaw
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  # Alert channels — set real values via --set or values-override
  telegram:
    botToken: ""
    chatId: ""
  slack:
    webhookUrl: ""
  # K8s event watch settings
  watch:
    namespaces: ""
    eventTypes: "Warning"
    errorPatterns: "CrashLoopBackOff,OOMKilled,ImagePullBackOff,ErrImagePull,FailedScheduling,Unhealthy,BackOff"
    intervalSeconds: "30"

# ============================================
# NodePort (폐쇄망/개발용)
# ============================================
nodePort:
  enabled: false
  frontend: 30080
  backend: 30800
  prometheus: 30090
  grafana: 30030
